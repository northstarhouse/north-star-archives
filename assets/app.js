(()=>{var he=Object.defineProperty,be=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var ee=(e,t,s)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t)=>{for(var s in t||(t={}))xe.call(t,s)&&ee(e,s,t[s]);if(Z)for(var s of Z(t))ve.call(t,s)&&ee(e,s,t[s]);return e},f=(e,t)=>be(e,fe(t));const{useState:k,useEffect:ye,useMemo:ie,useCallback:Ke,useRef:we}=React,ce="nsh-archives-cache-v1",de="nsh-archives-images-v1",Ne=300*1e3,te=800,oe=.82,ae=.5,ke=42e3,W=()=>{try{const e=localStorage.getItem(ce);if(!e)return null;const t=JSON.parse(e);return!t||!Array.isArray(t.objects)?null:t}catch(e){return console.warn("Failed to read cache:",e),null}},K=e=>e?e.isLocal?!0:_?!1:typeof e.url=="string"&&e.url.startsWith("data:"):!1,Ce=e=>e?e.includes("png")?"png":e.includes("webp")?"webp":e.includes("gif")?"gif":"jpg":"jpg",Ie=e=>{const t=typeof e=="string"?e.match(/^data:([^;]+);base64,(.+)$/):null;return t?{mimeType:t[1],data:t[2]}:null},Le=async e=>{var a,l;if(console.log("uploadLocalImagesToDrive called with",e==null?void 0:e.length,"images"),!Array.isArray(e)||e.length===0)return{images:e,failed:!1};let t=!1;const s=Date.now(),n=[];for(let i=0;i<e.length;i+=1){const r=e[i];if(console.log(`Processing image ${i}:`,{isLocal:r.isLocal,urlStart:(a=r.url)==null?void 0:a.substring(0,50)}),!K(r)){console.log(`Image ${i} is not local, skipping upload`),n.push(r);continue}const o=Ie(r.url);if(!o){console.error(`Image ${i}: Failed to parse data URL`),t=!0,n.push(r);continue}console.log(`Image ${i}: Parsed OK, mimeType=${o.mimeType}, data length=${(l=o.data)==null?void 0:l.length}`);try{const c=Ce(o.mimeType),y=`image-${s}-${i+1}.${c}`;console.log(`Image ${i}: Uploading as ${y}...`);const I=await x.uploadImage({filename:y,mimeType:o.mimeType,data:o.data});console.log(`Image ${i}: Upload SUCCESS, url=${I.url}`),n.push(f(b({},r),{url:I.url,isLocal:!1}))}catch(c){console.error(`Image ${i}: Upload FAILED:`,c),t=!0,n.push(r)}}return console.log("uploadLocalImagesToDrive result: failed=",t),{images:n,failed:t}},ue=e=>{if(!e||_)return e;const t=Array.isArray(e.images)?e.images.filter(s=>!K(s)):[];return f(b({},e),{images:t})},Se=e=>Array.isArray(e)?e.map(ue):e,$=e=>{try{localStorage.setItem(ce,JSON.stringify({objects:_?e:Se(e),updatedAt:Date.now()}))}catch(t){console.warn("Failed to write cache:",t)}},q=()=>{try{const e=localStorage.getItem(de);if(!e)return{};const t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Failed to read image cache:",e),{}}},se=e=>{try{localStorage.setItem(de,JSON.stringify(e||{}))}catch(t){console.warn("Failed to write image cache:",t)}},Ae=e=>!Array.isArray(e)||e.length===0||e.some(t=>t.isPrimary)?e:[f(b({},e[0]),{isPrimary:!0}),...e.slice(1)],G=e=>{if(!Array.isArray(e)||e.length===0)return e;const t=q();return e.map(s=>{const n=t[s.id];if(!Array.isArray(n)||n.length===0)return s;const a=Ae([...s.images||[],...n]);return f(b({},s),{images:a})})},J=!0,j=!1,_=!0,F="https://script.google.com/macros/s/AKfycbw6X8rdXiAUnasGTQdl-hcTN3zFa_Z4KPSa2au44i3u1eUbfwnov1jmX5yBEAdwduP_vQ/exec",ne=F;const me=["Furnishings","Art","Photographs","Decorative display","Documents","Tools/Equipment","Fixture","Docent Display"],De=["Donor","Purchase","Found on premises"],V=[{id:"1",title:"Original Redwood Ceiling Beam",aboutText:"This magnificent old-growth redwood beam is one of the original structural elements from the 1905 construction of the North Star House.",images:[{url:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800",caption:"Full beam view showing grain pattern",isPrimary:!0}],from:"Original Construction",designer:"Julia Morgan",maker:"Pacific Lumber Company",makerRole:"Fabricator",portfolioTitle:"North Star House - Structural Elements",mediumMaterials:"Old-growth Redwood, Wrought Iron hardware",measurements:`20' 6" L x 12" W x 14" H`,keywords:["structural","original","redwood","1900s","Arts & Crafts"],collection:"Building Materials",objectType:"Architectural Element",objectNumber:"NSH.1905.001"},{id:"2",title:"Hammered Copper Lantern",aboutText:"A stunning example of Arts and Crafts metalwork, this hammered copper lantern was designed by Julia Morgan specifically for the North Star House entry.",images:[{url:"https://images.unsplash.com/photo-1524484485831-a92ffc0de03f?w=800",caption:"Lantern illuminated at dusk",isPrimary:!0}],from:"Original Construction",designer:"Julia Morgan",maker:"Dirk van Erp Studio (attributed)",makerRole:"Artisan",portfolioTitle:"North Star House - Lighting Fixtures",mediumMaterials:"Hammered Copper, Amber Art Glass, Brass fittings",measurements:'24" H x 14" Diameter',keywords:["lighting","Arts & Crafts","handcrafted","copper"],collection:"Original Fixtures",objectType:"Fixture",objectNumber:"NSH.1905.015"}],x={isConfigured:()=>J&&F&&F.length>0,postJson:async(e,t)=>{const s=await fetch(e,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Request failed");return s.json()},fetchAll:async()=>{if(!J){const e=W();return(e==null?void 0:e.objects)||[]}if(!x.isConfigured())return console.log("Google Sheets not configured, using sample data"),V;try{const e=await fetch(`${F}?action=getAll`);if(!e.ok)throw new Error("Failed to fetch data");return(await e.json()).objects||[]}catch(e){return console.error("Error fetching from Google Sheets:",e),V}},create:async e=>{if(!x.isConfigured())return console.log("Google Sheets not configured, saving locally only"),f(b({},e),{id:Date.now().toString()});try{return(await x.postJson(F,{action:"create",object:e})).result||f(b({},e),{id:Date.now().toString()})}catch(t){return console.error("Error creating in Google Sheets:",t),f(b({},e),{id:Date.now().toString()})}},update:async e=>{if(!x.isConfigured())return console.log("Google Sheets not configured, saving locally only"),e;try{return await x.postJson(F,{action:"update",object:e}),e}catch(t){return console.error("Error updating in Google Sheets:",t),e}},delete:async e=>{if(!x.isConfigured())return console.log("Google Sheets not configured"),!0;try{return await x.postJson(F,{action:"delete",id:e}),!0}catch(t){return console.error("Error deleting from Google Sheets:",t),!1}},uploadImage:async({filename:e,mimeType:t,data:s})=>{var l;if(!j)throw new Error("Drive uploads disabled");if(!ne)throw new Error("Drive upload not configured");console.log(`Uploading image: ${e} (${t}), data length: ${(s||"").length}`);const n={action:"uploadImage",filename:e,mimeType:t,data:s},a=await x.postJson(ne,n);if(console.log("Upload response:",a),!a.success)throw new Error(a.error||"Upload failed");return console.log("Upload successful, URL:",(l=a.result)==null?void 0:l.url),a.result}},ge=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),React.createElement("polyline",{points:"12 19 5 12 12 5"})),Ee=({size:e=24,className:t=""})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t},React.createElement("circle",{cx:"11",cy:"11",r:"8"}),React.createElement("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),Q=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),React.createElement("line",{x1:"5",y1:"12",x2:"19",y2:"12"})),T=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),le=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("polyline",{points:"15 18 9 12 15 6"})),re=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("polyline",{points:"9 18 15 12 9 6"})),Oe=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),React.createElement("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})),Te=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("polyline",{points:"3 6 5 6 21 6"}),React.createElement("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),React.createElement("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),React.createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),React.createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"})),Pe=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("rect",{x:"3",y:"3",width:"7",height:"7"}),React.createElement("rect",{x:"14",y:"3",width:"7",height:"7"}),React.createElement("rect",{x:"14",y:"14",width:"7",height:"7"}),React.createElement("rect",{x:"3",y:"14",width:"7",height:"7"})),Re=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("circle",{cx:"11",cy:"11",r:"8"}),React.createElement("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),React.createElement("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),React.createElement("line",{x1:"8",y1:"11",x2:"14",y2:"11"})),Me=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("polyline",{points:"23 4 23 10 17 10"}),React.createElement("polyline",{points:"1 20 1 14 7 14"}),React.createElement("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})),Fe=({size:e=24})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("path",{d:"M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"}));const X=({size:e=24,className:t=""})=>React.createElement("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:`animate-spin ${t}`},React.createElement("circle",{cx:"12",cy:"12",r:"10",strokeOpacity:"0.25"}),React.createElement("path",{d:"M12 2a10 10 0 0 1 10 10",strokeOpacity:"1"})),Ue=({images:e,title:t})=>{const[s,n]=k(0),[a,l]=k(!1);if(!e||e.length===0)return React.createElement("div",{className:"bg-stone-200 rounded-lg h-64 flex items-center justify-center"},React.createElement("span",{className:"text-stone-500"},"No images available"));const i=e[s],r=()=>{n(c=>c===0?e.length-1:c-1)},o=()=>{n(c=>c===e.length-1?0:c+1)};return React.createElement(React.Fragment,null,React.createElement("div",{className:"relative bg-stone-100 rounded-xl overflow-hidden"},React.createElement("div",{className:"relative cursor-zoom-in bg-stone-100",onClick:()=>l(!0)},React.createElement("img",{src:i.url,alt:i.caption||t,className:"w-full h-auto object-contain",decoding:"async"}),React.createElement("button",{className:"absolute top-4 right-4 bg-white/80 hover:bg-white p-2 rounded-full transition-colors",onClick:c=>{c.stopPropagation(),l(!0)}},React.createElement(Re,{size:20}))),e.length>1&&React.createElement(React.Fragment,null,React.createElement("button",{onClick:r,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full transition-colors shadow-md"},React.createElement(le,{size:24})),React.createElement("button",{onClick:o,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full transition-colors shadow-md"},React.createElement(re,{size:24}))),i.caption&&React.createElement("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-4 pt-8"},React.createElement("p",{className:"text-white text-sm"},i.caption))),e.length>1&&React.createElement("div",{className:"flex gap-2 mt-3 overflow-x-auto pb-2"},e.map((c,y)=>React.createElement("button",{key:y,onClick:()=>n(y),className:`flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all ${y===s?"border-gold ring-2 ring-gold/30":"border-transparent opacity-70 hover:opacity-100"}`},React.createElement("img",{src:c.url,alt:"",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"})))),a&&React.createElement("div",{className:"fixed inset-0 z-50 lightbox-overlay flex items-center justify-center p-4",onClick:()=>l(!1)},React.createElement("button",{className:"absolute top-4 right-4 text-white hover:text-stone-300 transition-colors",onClick:()=>l(!1)},React.createElement(T,{size:32})),React.createElement("img",{src:i.url,alt:i.caption||t,className:"max-w-full max-h-full object-contain",onClick:c=>c.stopPropagation(),decoding:"async"}),i.caption&&React.createElement("p",{className:"absolute bottom-4 left-4 right-4 text-center text-white text-sm"},i.caption),e.length>1&&React.createElement(React.Fragment,null,React.createElement("button",{onClick:c=>{c.stopPropagation(),r()},className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/20 hover:bg-white/40 p-3 rounded-full transition-colors"},React.createElement(le,{size:32,className:"text-white"})),React.createElement("button",{onClick:c=>{c.stopPropagation(),o()},className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/20 hover:bg-white/40 p-3 rounded-full transition-colors"},React.createElement(re,{size:32,className:"text-white"})))))},C=({label:e,value:t,onClick:s,isClickable:n=!1})=>{if(!t||Array.isArray(t)&&t.length===0)return null;const a=Array.isArray(t)?t.join(", "):t;return React.createElement("div",{className:"py-3"},React.createElement("div",{className:"metadata-label"},e),n?React.createElement("button",{onClick:s,className:"metadata-value text-gold hover:text-gold-dark transition-colors text-left"},a):React.createElement("div",{className:"metadata-value"},a))},He=({object:e,onFilterClick:t})=>React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 border-t border-stone-200"},React.createElement(C,{label:"Object Type",value:e.objectType}),React.createElement(C,{label:"Object Number",value:e.objectNumber}),React.createElement(C,{label:"Accession Date",value:e.accessionDate}),React.createElement(C,{label:"Named Collection",value:e.collection,isClickable:!0,onClick:()=>t("collection",e.collection)}),React.createElement(C,{label:"Measurements",value:e.measurements}),React.createElement(C,{label:"Physical Characteristics",value:e.physicalCharacteristics}),React.createElement(C,{label:"Location in House/On Property",value:e.locationInHouse}),React.createElement(C,{label:"Designer",value:e.designer,isClickable:!!e.designer,onClick:()=>t("designer",e.designer)}),React.createElement(C,{label:"Maker",value:e.maker,isClickable:!!e.maker,onClick:()=>t("maker",e.maker)}),React.createElement(C,{label:"From (Origin/Donor/Source)",value:e.from}),React.createElement(C,{label:"Origin Details",value:e.originDetails}),React.createElement(C,{label:"Catalogued Date",value:e.cataloguedDate}),React.createElement(C,{label:"Cataloguer",value:e.cataloguer}),React.createElement(C,{label:"Acquisition Notes",value:e.acquisitionNotes}),React.createElement(C,{label:"Estimated Value",value:e.amountPaidOrEstimatedReplacementValue})),pe=({object:e,onClick:t})=>{var n,a;const s=((n=e.images)==null?void 0:n.find(l=>l.isPrimary))||((a=e.images)==null?void 0:a[0]);return React.createElement("button",{onClick:t,className:"bg-white rounded-xl border border-stone-200 overflow-hidden text-left card-hover w-full"},React.createElement("div",{className:"aspect-[4/3] bg-stone-100 overflow-hidden"},s?React.createElement("img",{src:s.url,alt:e.title,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):React.createElement("div",{className:"w-full h-full flex items-center justify-center text-stone-400"},"No image")),React.createElement("div",{className:"p-4"},React.createElement("h3",{className:"font-display text-lg font-semibold text-stone-800 mb-1 line-clamp-2"},e.title),React.createElement("p",{className:"text-sm text-stone-600 mb-2"},e.objectType),e.collection&&React.createElement("p",{className:"text-sm text-gold"},e.collection)))},_e=({currentObject:e,allObjects:t,onObjectClick:s})=>{const n=ie(()=>e?t.filter(l=>l.id!==e.id).map(l=>{var o;let i=0;l.collection===e.collection&&(i+=3),l.objectType===e.objectType&&(i+=2),l.designer&&l.designer===e.designer&&(i+=2),l.maker&&l.maker===e.maker&&(i+=2);const r=((o=l.keywords)==null?void 0:o.filter(c=>{var y;return(y=e.keywords)==null?void 0:y.includes(c)}))||[];return i+=r.length,f(b({},l),{score:i})}).filter(l=>l.score>0).sort((l,i)=>i.score-l.score).slice(0,3):[],[e,t]);return n.length===0?null:React.createElement("div",{className:"mt-12"},React.createElement("h3",{className:"font-display text-2xl font-semibold text-stone-800 mb-6"},"Related Objects"),React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},n.map(a=>React.createElement(pe,{key:a.id,object:a,onClick:()=>s(a)}))))},Be=({tags:e,onChange:t,placeholder:s="Add tag..."})=>{const[n,a]=k(""),l=()=>{const o=n.trim();o&&!e.includes(o)&&(t([...e,o]),a(""))},i=o=>{t(e.filter(c=>c!==o))},r=o=>{o.key==="Enter"&&(o.preventDefault(),l())};return React.createElement("div",{className:"space-y-2"},React.createElement("div",{className:"flex flex-wrap gap-2"},e.map((o,c)=>React.createElement("span",{key:c,className:"tag tag-gold flex items-center gap-1"},o,React.createElement("button",{type:"button",onClick:()=>i(o),className:"hover:text-red-600 ml-1"},React.createElement(T,{size:14}))))),React.createElement("div",{className:"flex gap-2"},React.createElement("input",{type:"text",value:n,onChange:o=>a(o.target.value),onKeyDown:r,placeholder:s,className:"flex-1 px-3 py-2 border border-stone-300 rounded-lg text-sm"}),React.createElement("button",{type:"button",onClick:l,className:"px-3 py-2 bg-stone-100 hover:bg-stone-200 rounded-lg transition-colors"},React.createElement(Q,{size:18}))))},ze=({images:e,onChange:t})=>{const[s,n]=k(""),[a,l]=k(!1),[i,r]=k(""),o=we(null),c=d=>new Promise((g,h)=>{const v=URL.createObjectURL(d),L=new Image;L.onload=()=>{try{const E=(p,u,D)=>{const S=document.createElement("canvas");return S.width=p,S.height=u,S.getContext("2d").drawImage(L,0,0,p,u),S.toDataURL("image/jpeg",D)},O=Math.max(L.width,L.height),P=O>te?te/O:1;let A=Math.max(1,Math.round(L.width*P)),R=Math.max(1,Math.round(L.height*P)),M=oe,B=E(A,R,M);if(_){let u=0;for(;B.length>ke&&u<30;)M>ae?M=Math.max(ae,M-.08):(A=Math.max(240,Math.round(A*.8)),R=Math.max(240,Math.round(R*.8)),M=oe),B=E(A,R,M),u+=1}URL.revokeObjectURL(v),g(B)}catch(E){URL.revokeObjectURL(v),h(E)}},L.onerror=()=>{URL.revokeObjectURL(v),h(new Error("Failed to load image"))},L.src=v}),y=d=>{if(!d)return!1;const g=(d.type||"").toLowerCase(),h=(d.name||"").toLowerCase();return g==="image/heic"||g==="image/heif"||h.endsWith(".heic")||h.endsWith(".heif")},I=async d=>{if(typeof window=="undefined"||typeof window.heic2any!="function")throw new Error("HEIC conversion not available.");const g=await window.heic2any({blob:d,toType:"image/jpeg",quality:.9}),h=(d.name||"image").replace(/\.(heic|heif)$/i,".jpg");return new File([g],h,{type:"image/jpeg"})},U=async d=>{var h;const g=(h=d.target.files)==null?void 0:h[0];if(g){l(!0),r("");try{const v=y(g)?await I(g):g,L=await c(v),E=L.split(",")[1]||"";if(!E)throw new Error("Invalid image data");let O=null;if(j&&x.isConfigured())try{const A=await x.uploadImage({filename:v.name,mimeType:v.type,data:E});O=(A==null?void 0:A.url)||null}catch(A){console.error("Image upload failed:",A)}const P=e.length===0;t(O?[...e,{url:O,caption:s.trim(),isPrimary:P}]:[...e,{url:L,caption:s.trim(),isPrimary:P,isLocal:!_}]),r(""),n("")}catch(v){console.error("Image upload failed:",v),r((v==null?void 0:v.message)||"Upload failed. Please try again.")}finally{l(!1),d.target.value=""}}},H=d=>{const g=e.filter((h,v)=>v!==d);g.length>0&&!g.some(h=>h.isPrimary)&&(g[0].isPrimary=!0),t(g)},m=d=>{t(e.map((g,h)=>f(b({},g),{isPrimary:h===d})))};return React.createElement("div",{className:"space-y-3"},e.map((d,g)=>React.createElement("div",{key:g,className:"flex items-start gap-3 bg-stone-50 p-3 rounded-lg"},React.createElement("img",{src:d.url,alt:"",className:"w-16 h-16 object-cover rounded"}),React.createElement("div",{className:"flex-1 min-w-0"},React.createElement("p",{className:"text-sm truncate"},d.url),d.caption&&React.createElement("p",{className:"text-xs text-stone-500"},d.caption),React.createElement("button",{type:"button",onClick:()=>m(g),className:`text-xs mt-1 ${d.isPrimary?"text-gold font-medium":"text-stone-400 hover:text-gold"}`},d.isPrimary?"Primary Image":"Set as Primary")),React.createElement("button",{type:"button",onClick:()=>H(g),className:"text-stone-400 hover:text-red-600"},React.createElement(T,{size:18})))),React.createElement("div",{className:"space-y-2"},React.createElement("input",{type:"text",value:s,onChange:d=>n(d.target.value),placeholder:"Caption (optional)",className:"w-full px-3 py-2 border border-stone-300 rounded-lg text-sm"}),React.createElement("input",{ref:o,type:"file",accept:"image/*",onChange:U,className:"hidden"}),React.createElement("button",{type:"button",onClick:()=>{var d;return(d=o.current)==null?void 0:d.click()},disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-stone-100 hover:bg-stone-200 disabled:bg-stone-200 rounded-lg transition-colors text-sm"},a?React.createElement(X,{size:16}):React.createElement(Q,{size:16}),a?"Uploading...":"Add Image"),i&&React.createElement("p",{className:"text-xs text-red-600"},i)))},$e=({object:e,onSave:t,onCancel:s,isSaving:n})=>{const[a,l]=k(b({title:"",aboutText:"",locationInHouse:"",images:[],from:"",designer:"",maker:"",measurements:"",keywords:[],collection:"",objectType:"",objectNumber:"",accessionDate:"",physicalCharacteristics:"",cataloguedDate:"",cataloguer:"Lisa Robinson",acquisitionNotes:"",amountPaidOrEstimatedReplacementValue:""},e)),i=o=>{if(o.preventDefault(),!a.title.trim()){alert("Title is required");return}t(f(b({},a),{id:a.id||Date.now().toString(),createdAt:a.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()}))},r=(o,c)=>{l(y=>f(b({},y),{[o]:c}))};return React.createElement("form",{onSubmit:i,className:"space-y-8"},React.createElement("section",null,React.createElement("h3",{className:"font-display text-xl font-semibold text-stone-800 mb-4"},"Images"),React.createElement("p",{className:"text-sm text-stone-500 mb-3"},"Add multiple images with zoom and carousel support"),React.createElement(ze,{images:a.images,onChange:o=>r("images",o)})),React.createElement("section",null,React.createElement("h3",{className:"font-display text-xl font-semibold text-stone-800 mb-4"},"Basic Information"),React.createElement("div",{className:"space-y-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Name of Object ",React.createElement("span",{className:"text-red-500"},"*")),React.createElement("input",{type:"text",value:a.title,onChange:o=>r("title",o.target.value),className:"w-full px-4 py-3 border border-stone-300 rounded-lg",required:!0})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"About this Object"),React.createElement("textarea",{value:a.aboutText,onChange:o=>r("aboutText",o.target.value),rows:5,className:"w-full px-4 py-3 border border-stone-300 rounded-lg resize-none"})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Location in House/On Property"),React.createElement("input",{type:"text",value:a.locationInHouse,onChange:o=>r("locationInHouse",o.target.value),placeholder:"e.g., Dining Room, East wall",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"})))),React.createElement("section",null,React.createElement("h3",{className:"font-display text-xl font-semibold text-stone-800 mb-4"},"Origin Information"),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"From (Origin, Donor, or Source)"),React.createElement("select",{value:a.from,onChange:o=>r("from",o.target.value),className:"w-full px-4 py-3 border border-stone-300 rounded-lg bg-white"},React.createElement("option",{value:""},"Select origin..."),De.map(o=>React.createElement("option",{key:o,value:o},o)))),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Name / Store / Where on Premises"),React.createElement("input",{type:"text",value:a.originDetails,onChange:o=>r("originDetails",o.target.value),placeholder:"e.g., donor name, store name, or where it was found",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Accession Date"),React.createElement("input",{type:"text",value:a.accessionDate,onChange:o=>r("accessionDate",o.target.value),placeholder:"e.g., 07/25/2025",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"}))),React.createElement("div",{className:"mt-4"},React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Estimated Value"),React.createElement("input",{type:"text",value:a.amountPaidOrEstimatedReplacementValue,onChange:o=>r("amountPaidOrEstimatedReplacementValue",o.target.value),placeholder:"e.g., $1,200 (estimated)",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"})),React.createElement("div",{className:"mt-4"},React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Acquisition Notes"),React.createElement("textarea",{value:a.acquisitionNotes,onChange:o=>r("acquisitionNotes",o.target.value),placeholder:"e.g., Donor requests items be returned if administration changes",className:"w-full px-4 py-3 border border-stone-300 rounded-lg",rows:2}))),React.createElement("section",null,React.createElement("h3",{className:"font-display text-xl font-semibold text-stone-800 mb-4"},"Creators"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Designer(s)"),React.createElement("input",{type:"text",value:a.designer,onChange:o=>r("designer",o.target.value),placeholder:"e.g., Julia Morgan",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Maker"),React.createElement("input",{type:"text",value:a.maker,onChange:o=>r("maker",o.target.value),placeholder:"e.g., Pacific Lumber Company",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"})))),React.createElement("section",null,React.createElement("h3",{className:"font-display text-xl font-semibold text-stone-800 mb-4"},"Physical Details"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Measurements"),React.createElement("input",{type:"text",value:a.measurements,onChange:o=>r("measurements",o.target.value),placeholder:'e.g., 24" x 36" x 12"',className:"w-full px-4 py-3 border border-stone-300 rounded-lg"}))),React.createElement("div",{className:"mt-4"},React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Physical Characteristics"),React.createElement("input",{type:"text",value:a.physicalCharacteristics,onChange:o=>r("physicalCharacteristics",o.target.value),placeholder:"e.g., dark blue flower pattern on white porcelain",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"}))),React.createElement("section",null,React.createElement("h3",{className:"font-display text-xl font-semibold text-stone-800 mb-4"},"Classification"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",{className:"md:col-span-2"},React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Named Collection"),React.createElement("select",{value:a.collection,onChange:o=>r("collection",o.target.value),className:"w-full px-4 py-3 border border-stone-300 rounded-lg bg-white"},React.createElement("option",{value:""},"Select collection..."),me.map(o=>React.createElement("option",{key:o,value:o},o)))),React.createElement("div",{className:"md:col-span-2"},React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Object Number"),React.createElement("input",{type:"text",value:a.objectNumber,onChange:o=>r("objectNumber",o.target.value),placeholder:"e.g., NSH.1905.001",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"})))),React.createElement("section",null,React.createElement("h3",{className:"font-display text-xl font-semibold text-stone-800 mb-4"},"Cataloging"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Catalogued Date"),React.createElement("input",{type:"text",value:a.cataloguedDate,onChange:o=>r("cataloguedDate",o.target.value),placeholder:"e.g., 09/01/2025",className:"w-full px-4 py-3 border border-stone-300 rounded-lg"})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium text-stone-700 mb-1"},"Cataloguer"),React.createElement("select",{value:a.cataloguer,onChange:o=>r("cataloguer",o.target.value),className:"w-full px-4 py-3 border border-stone-300 rounded-lg bg-white"},React.createElement("option",{value:"Lisa Robinson"},"Lisa Robinson"),React.createElement("option",{value:"Rebekah Freeman"},"Rebekah Freeman"),React.createElement("option",{value:"Other"},"Other"))))),React.createElement("section",null,React.createElement("h3",{className:"font-display text-xl font-semibold text-stone-800 mb-4"},"Keywords for Search"),React.createElement(Be,{tags:a.keywords,onChange:o=>r("keywords",o),placeholder:"Add keyword..."})),React.createElement("div",{className:"flex gap-4 pt-4 border-t border-stone-200"},React.createElement("button",{type:"submit",disabled:n,className:"flex-1 bg-gold hover:bg-gold-dark disabled:bg-stone-400 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center gap-2"},n?React.createElement(React.Fragment,null,React.createElement(X,{size:20}),"Saving..."):React.createElement(React.Fragment,null,React.createElement(Fe,{size:20}),e!=null&&e.id?"Save Changes":"Add Object")),React.createElement("button",{type:"button",onClick:s,disabled:n,className:"px-6 py-3 bg-stone-100 hover:bg-stone-200 disabled:bg-stone-100 rounded-lg font-medium transition-colors"},"Cancel")))},Ge=({object:e,allObjects:t,onBack:s,onEdit:n,onDelete:a,onFilterClick:l,onObjectClick:i,isDeleting:r})=>React.createElement("div",{className:"max-w-4xl mx-auto"},React.createElement("button",{onClick:s,className:"flex items-center gap-2 text-stone-600 hover:text-gold transition-colors mb-6"},React.createElement(ge,{size:20}),React.createElement("span",null,"Back to Collection")),React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)] gap-10"},React.createElement("div",null,React.createElement(Ue,{images:e.images,title:e.title})),React.createElement("div",null,React.createElement("div",{className:"mb-6"},React.createElement("div",{className:"flex items-start justify-between gap-4"},React.createElement("div",null,React.createElement("h1",{className:"font-display text-3xl md:text-4xl font-semibold text-stone-800"},e.title)),React.createElement("button",{onClick:()=>n(e),className:"flex items-center gap-2 px-4 py-2 bg-stone-100 hover:bg-stone-200 rounded-lg transition-colors text-sm"},React.createElement(Oe,{size:16}),"Edit"),React.createElement("button",{onClick:()=>a(e),disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-red-50 hover:bg-red-100 text-red-700 rounded-lg transition-colors text-sm disabled:opacity-50"},React.createElement(Te,{size:16}),"Delete"))),e.aboutText&&React.createElement("div",{className:"mb-8"},React.createElement("h2",{className:"font-display text-xl font-semibold text-stone-800 mb-3"},"About this Object"),React.createElement("p",{className:"text-stone-700 leading-relaxed whitespace-pre-wrap"},e.aboutText)),React.createElement(He,{object:e,onFilterClick:l}),e.keywords&&e.keywords.length>0&&React.createElement("div",{className:"mt-6 pt-6 border-t border-stone-200"},React.createElement("h3",{className:"metadata-label mb-2"},"Keywords for Search"),React.createElement("div",{className:"flex flex-wrap gap-2"},e.keywords.map((o,c)=>React.createElement("button",{key:c,onClick:()=>l("keywords",o),className:"tag"},o)))))),React.createElement(_e,{currentObject:e,allObjects:t,onObjectClick:i})),Je=({objects:e,filters:t,onFilterChange:s,onObjectClick:n,onAddNew:a,onRefresh:l,isLoading:i,isConnected:r})=>{const[o,c]=k(""),y=me,I=ie(()=>e.filter(m=>{var d;if(o){const g=o.toLowerCase();if(![m.title,m.aboutText,m.objectType,m.designer,m.maker,m.from,...m.keywords||[]].join(" ").toLowerCase().includes(g))return!1}return!(t.collection&&m.collection!==t.collection||t.keywords&&!((d=m.keywords)!=null&&d.includes(t.keywords))||t.designer&&m.designer!==t.designer||t.maker&&m.maker!==t.maker)}),[e,o,t]),U=()=>{c(""),s({})},H=o||Object.values(t).some(m=>m);return React.createElement("div",{className:"max-w-6xl mx-auto"},React.createElement("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8"},React.createElement("div",null,React.createElement("h1",{className:"font-display text-3xl md:text-4xl font-semibold text-stone-800"},"Archival Collection")),React.createElement("div",{className:"flex gap-2"},React.createElement("button",{onClick:l,disabled:i,className:"flex items-center gap-2 px-4 py-3 bg-stone-100 hover:bg-stone-200 rounded-lg transition-colors",title:"Refresh from Google Sheets"},React.createElement(Me,{size:20,className:i?"animate-spin":""})),React.createElement("button",{onClick:a,className:"flex items-center gap-2 bg-gold hover:bg-gold-dark text-white px-5 py-3 rounded-lg font-medium transition-colors"},React.createElement(Q,{size:20}),"Add Object"))),React.createElement("div",{className:"bg-white rounded-xl border border-stone-200 p-4 mb-6"},React.createElement("div",{className:"flex flex-col md:flex-row gap-4"},React.createElement("div",{className:"flex-1 relative"},React.createElement(Ee,{size:20,className:"absolute left-3 top-1/2 -translate-y-1/2 text-stone-400"}),React.createElement("input",{type:"text",value:o,onChange:m=>c(m.target.value),placeholder:"Search objects, keywords, makers...",className:"w-full pl-10 pr-4 py-3 border border-stone-300 rounded-lg"})),React.createElement("select",{value:t.collection||"",onChange:m=>s(f(b({},t),{collection:m.target.value||null})),className:"px-4 py-3 border border-stone-300 rounded-lg bg-white min-w-[180px]"},React.createElement("option",{value:""},"All Collections"),y.map(m=>React.createElement("option",{key:m,value:m},m)))),H&&React.createElement("div",{className:"flex flex-wrap items-center gap-2 mt-4 pt-4 border-t border-stone-100"},React.createElement("span",{className:"text-sm text-stone-500"},"Active filters:"),o&&React.createElement("span",{className:"tag tag-gold"},'Search: "',o,'"',React.createElement("button",{onClick:()=>c(""),className:"ml-1"},React.createElement(T,{size:14}))),t.collection&&React.createElement("span",{className:"tag tag-gold"},"Collection: ",t.collection,React.createElement("button",{onClick:()=>s(f(b({},t),{collection:null})),className:"ml-1"},React.createElement(T,{size:14}))),t.keywords&&React.createElement("span",{className:"tag tag-gold"},"Keyword: ",t.keywords,React.createElement("button",{onClick:()=>s(f(b({},t),{keywords:null})),className:"ml-1"},React.createElement(T,{size:14}))),t.designer&&React.createElement("span",{className:"tag tag-gold"},"Designer: ",t.designer,React.createElement("button",{onClick:()=>s(f(b({},t),{designer:null})),className:"ml-1"},React.createElement(T,{size:14}))),t.maker&&React.createElement("span",{className:"tag tag-gold"},"Maker: ",t.maker,React.createElement("button",{onClick:()=>s(f(b({},t),{maker:null})),className:"ml-1"},React.createElement(T,{size:14}))),React.createElement("button",{onClick:U,className:"text-sm text-gold hover:text-gold-dark ml-2"},"Clear all"))),React.createElement("p",{className:"text-stone-600 mb-4"},I.length," ",I.length===1?"object":"objects"," found"),i?React.createElement("div",{className:"text-center py-16 bg-white rounded-xl border border-stone-200"},React.createElement(X,{size:48,className:"mx-auto text-gold mb-4"}),React.createElement("p",{className:"text-stone-600 text-lg"},"Loading from Google Sheets...")):I.length===0?React.createElement("div",{className:"text-center py-16 bg-white rounded-xl border border-stone-200"},React.createElement(Pe,{size:48,className:"mx-auto text-stone-300 mb-4"}),React.createElement("p",{className:"text-stone-600 text-lg"},"No objects match your search"),React.createElement("button",{onClick:U,className:"mt-4 text-gold hover:text-gold-dark"},"Clear filters")):React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},I.map(m=>React.createElement(pe,{key:m.id,object:m,onClick:()=>n(m)}))))},We=()=>{const[e,t]=k([]),[s,n]=k("browse"),[a,l]=k(null),[i,r]=k(null),[o,c]=k({}),[y,I]=k(!0),[U,H]=k(!1),[m,d]=k(!1),[g,h]=k(!1);ye(()=>{v()},[]);const v=async({useCache:p=!0}={})=>{var S,w;if(!J){const N=W();t(G((N==null?void 0:N.objects)||[])),h(!1),I(!1);return}const u=p?W():null,D=u&&Date.now()-u.updatedAt<Ne;(S=u==null?void 0:u.objects)!=null&&S.length?(t(G(u.objects)),h(x.isConfigured()),I(!1)):I(!0);try{const N=await x.fetchAll();t(G(N)),h(x.isConfigured()),$(N)}catch(N){console.error("Failed to load data:",N),(w=u==null?void 0:u.objects)!=null&&w.length||t(G(V))}I(!1)},L=p=>{l(p),n("detail"),window.scrollTo(0,0)},E=()=>{l(null),n("browse")},O=()=>{r(null),n("add"),window.scrollTo(0,0)},P=p=>{r(p),n("edit"),window.scrollTo(0,0)},A=async p=>{H(!0);try{let u=p;if(j&&x.isConfigured()){const w=await Le(p.images||[]);u=f(b({},p),{images:w.images}),w.failed&&alert("Some images could not be uploaded to Drive. Please try saving again.")}const D=(u.images||[]).filter(K),S=ue(u);if(i)await x.update(S),t(w=>{const N=w.map(z=>z.id===u.id?u:z);return $(N),N}),l(u);else{const w=await x.create(S),N=f(b({},u),{id:w.id||u.id});u=N,t(z=>{const Y=[...z,N];return $(Y),Y}),l(N)}if(u.id){const w=q();D.length>0?w[u.id]=D:delete w[u.id],se(w)}n("detail"),r(null)}catch(u){console.error("Failed to save:",u),alert("Failed to save. Please try again.")}H(!1)},R=()=>{n(a?"detail":"browse"),r(null)};return React.createElement("div",{className:"min-h-screen bg-stone-50"},React.createElement("header",{className:"bg-white border-b border-stone-200 sticky top-0 z-40"},React.createElement("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8"},React.createElement("div",{className:"flex items-center justify-between h-16"},React.createElement("button",{onClick:()=>{n("browse"),l(null),c({})},className:"flex items-center gap-3"},React.createElement("div",{className:"w-10 h-10 rounded-full bg-gold flex items-center justify-center"},React.createElement("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"white"},React.createElement("path",{d:"M12 3.5l2.6 5.9L21 12l-6.4 2.6L12 20.5l-2.6-5.9L3 12l6.4-2.6L12 3.5z"}))),React.createElement("span",{className:"font-display text-xl font-semibold text-stone-800"},"North Star House")),React.createElement("span",{className:"text-stone-500 text-sm hidden sm:block"},"Archival Collection")))),React.createElement("main",{className:"px-4 sm:px-6 lg:px-8 py-8"},s==="browse"&&React.createElement(Je,{objects:e,filters:o,onFilterChange:c,onObjectClick:L,onAddNew:O,onRefresh:()=>v({useCache:!1}),isLoading:y,isConnected:g}),s==="detail"&&a&&React.createElement(Ge,{object:a,allObjects:e,onBack:E,onEdit:P,onDelete:async p=>{if(!(!(p!=null&&p.id)||!window.confirm(`Delete "${p.title}"? This cannot be undone.`))){d(!0);try{if(J&&x.isConfigured()&&!await x.delete(p.id))throw new Error("Delete failed");t(S=>{const w=S.filter(N=>N.id!==p.id);return $(w),w});const D=q();delete D[p.id],se(D),l(null),n("browse"),window.scrollTo(0,0)}catch(D){console.error("Failed to delete object:",D),alert("Delete failed. Please try again.")}d(!1)}},isDeleting:m,onFilterClick:(p,u)=>{c({[p]:u}),l(null),n("browse"),window.scrollTo(0,0)},onObjectClick:L}),(s==="add"||s==="edit")&&React.createElement("div",{className:"max-w-3xl mx-auto"},React.createElement("button",{onClick:R,className:"flex items-center gap-2 text-stone-600 hover:text-gold transition-colors mb-6"},React.createElement(ge,{size:20}),React.createElement("span",null,"Cancel")),React.createElement("div",{className:"bg-white rounded-xl border border-stone-200 p-6 md:p-8"},React.createElement("h2",{className:"font-display text-2xl font-semibold text-stone-800 mb-6"},s==="edit"?"Edit Object":"Add New Object"),React.createElement($e,{object:i,onSave:A,onCancel:R,isSaving:U})))),React.createElement("footer",{className:"bg-white border-t border-stone-200 mt-16"},React.createElement("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},React.createElement("div",{className:"text-center text-stone-500 text-sm"},React.createElement("p",null,"North Star House Archives"),React.createElement("p",{className:"mt-1"},"A Julia Morgan Historic Building")))))},qe=ReactDOM.createRoot(document.getElementById("root"));qe.render(React.createElement(We,null));})();
